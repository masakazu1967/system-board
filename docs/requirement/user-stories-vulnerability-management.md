# ユーザーストーリー: 脆弱性管理コンテキスト

**作成日**: 2025年9月18日
**更新日**: 2025年9月18日
**ソース**: イベントストーミング Phase1-2 成果物
**Bounded Context**: Vulnerability Management Context

---

## 1. 脆弱性検出・評価

### US-VM-001: 自動脆弱性スキャン

**As a** システム担当者
**I want to** システムの脆弱性を自動的にスキャンする
**So that** 新しい脆弱性を迅速に発見できる

**受け入れ条件**:

- [ ] 日次02:00に全システムの脆弱性スキャンが自動実行される
- [ ] CVE Scanner ActorがNVD APIから最新情報を取得
- [ ] パッケージ、OS、ミドルウェア、フレームワークレベルで検出
- [ ] 検出時に`VulnerabilityDetected`イベントが発行される
- [ ] スキャン結果がシステム管理者に通知される

**Event**: `VulnerabilityDetected`
**Command**: `ScanVulnerabilities`（CVE Scanner Actor自動実行）
**Priority**: High
**Estimate**: 8 Story Points

---

### US-VM-002: CVSSスコア自動割当

**As a** システム担当者
**I want to** 検出された脆弱性にCVSSスコアを自動割当する
**So that** 脆弱性の深刻度を客観的に評価できる

**受け入れ条件**:

- [ ] 脆弱性検出時にNVD APIからCVSSスコアを自動取得
- [ ] CVSS 3.1基準でスコア（0.0-10.0）を割当
- [ ] スコア割当完了時に`CVSSScoreAssigned`イベントが発行される
- [ ] スコア9.0以上の場合は自動的に緊急タスクが生成される
- [ ] スコア履歴が管理される

**Event**: `CVSSScoreAssigned`
**Command**: `AssignCVSSScore`（システム自動実行）
**Priority**: High
**Estimate**: 5 Story Points

---

### US-VM-003: リスク評価実行

**As a** システム担当者
**I want to** 脆弱性のリスク評価を実行する
**So that** システムへの影響度を判断できる

**受け入れ条件**:

- [ ] CVSSスコア、システム重要度、露出レベルを統合してリスク評価
- [ ] 手動でのリスク評価実行が可能
- [ ] 評価結果（Critical/High/Medium/Low）が算出される
- [ ] 評価完了時に`RiskAssessmentCompleted`イベントが発行される
- [ ] Critical評価時は自動的に緊急タスクが生成される

**Event**: `RiskAssessmentCompleted`
**Command**: `AssessVulnerabilityRisk`
**Priority**: High
**Estimate**: 8 Story Points

---

## 2. 脆弱性対応・緩和

### US-VM-004: 緩和計画作成

**As a** 情報システム管理者
**I want to** 脆弱性の緩和計画を作成する
**So that** 組織的に脆弱性対応を進めることができる

**受け入れ条件**:

- [ ] 脆弱性情報、影響範囲、対応策を含む計画を作成
- [ ] 対応優先度、実施予定日、担当者を設定
- [ ] 関連システムへの影響を考慮した計画策定
- [ ] 計画承認ワークフローが組み込まれている
- [ ] 作成完了時に`MitigationPlanCreated`イベントが発行される

**Event**: `MitigationPlanCreated`
**Command**: `CreateMitigationPlan`
**Priority**: High
**Estimate**: 8 Story Points

---

### US-VM-005: セキュリティパッチ適用

**As a** システム担当者
**I want to** セキュリティパッチを適用する
**So that** 脆弱性を修正できる

**受け入れ条件**:

- [ ] 承認された緩和計画に基づいてパッチ適用
- [ ] 適用前に依存関係と影響範囲を確認
- [ ] 適用プロセスの進捗状況を追跡可能
- [ ] 適用完了時に`SecurityPatchApplied`イベントが発行される
- [ ] 適用後の動作確認とロールバック手順を準備

**Event**: `SecurityPatchApplied`
**Command**: `ApplySecurityPatch`
**Priority**: High
**Estimate**: 8 Story Points

---

### US-VM-006: 脆弱性解決確認

**As a** システム担当者
**I want to** 脆弱性が解決されたことを確認する
**So that** 対応完了を正式に記録できる

**受け入れ条件**:

- [ ] パッチ適用後の再スキャンで脆弱性消失を確認
- [ ] 解決確認テストの実行と結果記録
- [ ] 解決完了時に`VulnerabilityResolved`イベントが発行される
- [ ] 対応履歴とエビデンスが保存される
- [ ] 関連タスクが自動的にクローズされる

**Event**: `VulnerabilityResolved`
**Command**: `ResolveVulnerability`
**Priority**: Medium
**Estimate**: 5 Story Points

---

## 3. 外部システム連携

### US-VM-007: CVE情報自動更新

**As a** システム担当者
**I want to** CVE脆弱性情報を自動的に更新する
**So that** 最新の脆弱性情報を常に把握できる

**受け入れ条件**:

- [ ] NVD APIから日次でCVE情報を自動取得（毎日02:30）
- [ ] 新規CVE、既存CVEの更新情報を処理
- [ ] Rate Limit（2,000 requests/30分）を考慮した取得処理
- [ ] 取得完了時に`CVEInformationReceived`イベントが発行される
- [ ] 取得失敗時はFallbackモードで継続

**Event**: `CVEInformationReceived`
**Command**: `FetchCVEUpdates`（Integration Gateway Actor自動実行）
**Priority**: High
**Estimate**: 8 Story Points

---

### US-VM-008: 脆弱性データベース更新

**As a** システム担当者
**I want to** 内部の脆弱性データベースを更新する
**So that** 最新の脆弱性情報でシステムをスキャンできる

**受け入れ条件**:

- [ ] CVE情報受信後に内部データベースを自動更新
- [ ] CVSS スコア、影響製品、対応策情報を格納
- [ ] データ整合性チェックと重複排除を実行
- [ ] 更新完了時に`VulnerabilityDatabaseUpdated`イベントが発行される
- [ ] 更新後に影響システムの再評価がトリガーされる

**Event**: `VulnerabilityDatabaseUpdated`
**Command**: `UpdateVulnerabilityDatabase`（システム自動実行）
**Priority**: High
**Estimate**: 5 Story Points

---

## 4. アラート・通知

### US-VM-009: 緊急脆弱性アラート

**As a** システム担当者
**I want to** 高危険度脆弱性のアラートを受け取る
**So that** 迅速に対応を開始できる

**受け入れ条件**:

- [ ] CVSS 9.0以上の脆弱性検出時に即座にアラート発行
- [ ] Microsoft Teams経由で関係者に通知
- [ ] アラート内容にはCVE ID、影響システム、推奨対応が含まれる
- [ ] アラート発行時に`AlertTriggered`イベントが発行される
- [ ] 夜間・休日でも緊急連絡が届く仕組み

**Event**: `AlertTriggered`
**Command**: `TriggerSecurityAlert`（システム自動実行）
**Priority**: High
**Estimate**: 5 Story Points

---

### US-VM-010: セキュリティ管理者通知

**As a** 情報システム管理者
**I want to** 重要な脆弱性について通知を受け取る
**So that** 組織的な対応を指示できる

**受け入れ条件**:

- [ ] Critical/Highリスクの脆弱性について管理者に通知
- [ ] 緊急タスク生成時の自動通知
- [ ] 通知内容には影響範囲、推奨対応期限が含まれる
- [ ] 通知確認状況をトラッキング
- [ ] 通知時に`SecurityManagerNotified`イベントが発行される

**Event**: `SecurityManagerNotified`
**Command**: `NotifySecurityManager`（システム自動実行）
**Priority**: High
**Estimate**: 3 Story Points

---

## 5. 報告・分析

### US-VM-011: 脆弱性ダッシュボード表示

**As a** システム担当者
**I want to** 脆弱性の状況をダッシュボードで確認する
**So that** 現在の脆弱性対応状況を把握できる

**受け入れ条件**:

- [ ] システム別、重要度別の脆弱性数を表示
- [ ] CVSSスコア分布、対応状況の可視化
- [ ] 緊急対応が必要な脆弱性のハイライト表示
- [ ] 対応期限が近い項目の警告表示
- [ ] リアルタイムでの情報更新

**Event**: `VulnerabilityDashboardRequested`
**Command**: `ViewVulnerabilityDashboard`
**Priority**: High
**Estimate**: 8 Story Points

---

### US-VM-012: 脆弱性トレンド分析

**As a** 情報システム管理者
**I want to** 脆弱性の傾向を分析する
**So that** セキュリティ対策の改善点を特定できる

**受け入れ条件**:

- [ ] 月次・四半期での脆弱性発生傾向を分析
- [ ] システム種別、重要度別の脆弱性分布
- [ ] 対応時間の分析（検出から解決まで）
- [ ] 再発脆弱性の特定と分析
- [ ] 分析結果をレポート形式で出力

**Event**: `VulnerabilityTrendAnalysisCompleted`
**Command**: `AnalyzeVulnerabilityTrends`
**Priority**: Medium
**Estimate**: 8 Story Points

---

## 関連ドキュメント

- イベントストーミング Phase1: `/docs/event-storming/phase1-domain-events.md`
- イベントストーミング Phase2: `/docs/event-storming/phase2-commands-actors.md`
- ビジネス要件: `/docs/requirement/business-requirement.md`

## 実装優先順位

1. **P1 (高)**: US-VM-001, US-VM-002, US-VM-003, US-VM-007, US-VM-009 - 基本脆弱性管理
2. **P2 (中)**: US-VM-004, US-VM-005, US-VM-008, US-VM-010, US-VM-011 - 対応・通知機能
3. **P3 (低)**: US-VM-006, US-VM-012 - 高度な分析機能

## Critical Path（CVSS 9.0以上の緊急対応フロー）

US-VM-001 → US-VM-002 → US-VM-003 → US-VM-009 → US-VM-010 → US-VM-004 → US-VM-005 → US-VM-006
